"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.God=void 0;var otplib_1=require("otplib"),Password_1=require("../Password"),uuid_1=require("uuid"),God=function(){function e(){this._password=new Password_1.Password}return e.prototype.buildSkeleton=function(e){if(!this.emailValid(e))throw new Error("The provided email is invalid: ".concat(e));var t=(0,uuid_1.v4)();if(!(0,uuid_1.validate)(t)||4!=(0,uuid_1.version)(t))throw new Error("The generated uid is invalid: ".concat(t));var r=this._password.generatePassword(),o=this.generateOTPSecret();if(!this.otpSecretValid(o))throw new Error("The generated OTP Secret is invalid: ".concat(o));var i=this.generateOTPToken(o);if(!this.otpTokenValid(i,o))throw new Error("The generated OTP Token is invalid: ".concat(i));return{buildDate:(new Date).toDateString(),uid:t,email:e.toLowerCase(),password:r,otpSecret:o}},e.prototype.generateOTPSecret=function(){return otplib_1.authenticator.generateSecret()},e.prototype.generateOTPToken=function(e){if(!this.otpSecretValid(e))throw new Error("Cannot generate an OTP Token with an invalid secret: ".concat(e));return otplib_1.authenticator.generate(e)},e.prototype.emailValid=function(e){if("string"==typeof e){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)}return!1},e.prototype.otpSecretValid=function(e){return"string"==typeof e&&e.length>=10&&e.length<=32},e.prototype.otpTokenValid=function(e,t){if("string"!=typeof e||6!=e.length||!/[0-9]/.test(e))return!1;if(!this.otpSecretValid(t))throw new Error("Cannot check an OTP Token with an invalid secret: ".concat(t));return otplib_1.authenticator.check(e,t)},e}();exports.God=God;